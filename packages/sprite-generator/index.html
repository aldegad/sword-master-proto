<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sprite Generator - 동영상 → 스프라이트 변환기</title>
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <div id="app">
      <header>
        <h1>🎬 Sprite Generator</h1>
        <p>동영상을 스프라이트 시트로 변환하고 배경을 제거합니다</p>
      </header>

      <main>
        <!-- 모드 선택 탭 -->
        <section class="step" id="step-mode">
          <div class="mode-tabs">
            <button class="mode-tab active" id="mode-video-tab" data-mode="video">
              <span class="tab-icon">🎬</span>
              <span class="tab-text">동영상에서 생성</span>
            </button>
            <button class="mode-tab" id="mode-sprite-tab" data-mode="sprite">
              <span class="tab-icon">🖼️</span>
              <span class="tab-text">스프라이트 편집</span>
            </button>
          </div>
        </section>

        <!-- Step 1A: 동영상 업로드 -->
        <section class="step" id="step-upload">
          <h2>1. 동영상 업로드</h2>
          <div class="upload-area" id="upload-area">
            <input type="file" id="video-input" accept="video/*" hidden />
            <label for="video-input" class="upload-label">
              <span class="upload-icon">📁</span>
              <span>동영상 파일을 드래그하거나 클릭하여 선택</span>
              <span class="supported-formats">지원 형식: MP4, WebM, MOV</span>
            </label>
          </div>
          <video id="video-preview" controls hidden></video>
        </section>

        <!-- Step 1B: 스프라이트 시트 업로드 -->
        <section class="step" id="step-sprite-upload" hidden>
          <h2>1. 스프라이트 시트 업로드</h2>
          <div class="upload-row">
            <div class="upload-area" id="sprite-upload-area">
              <input type="file" id="sprite-input" accept="image/*" hidden />
              <label for="sprite-input" class="upload-label">
                <span class="upload-icon">🖼️</span>
                <span>스프라이트 시트 이미지 업로드</span>
                <span class="supported-formats">지원 형식: PNG, JPG, WebP</span>
              </label>
            </div>
            <div class="upload-area upload-area-optional" id="json-upload-area">
              <input type="file" id="json-input" accept=".json" hidden />
              <label for="json-input" class="upload-label">
                <span class="upload-icon">📄</span>
                <span>JSON 메타데이터 (선택사항)</span>
                <span class="supported-formats">프레임 정보 자동 로드</span>
              </label>
            </div>
          </div>
          <div id="sprite-preview-container" hidden>
            <img id="sprite-preview" alt="Sprite Preview" />
            <div id="sprite-preview-info"></div>
          </div>
        </section>

        <!-- Step 2B: 프레임 분할 설정 -->
        <section class="step" id="step-sprite-config" hidden>
          <h2>2. 프레임 분할 설정</h2>
          <div id="frame-suggestions" hidden>
            <p class="hint">💡 추천 프레임 크기:</p>
            <div class="suggestions-list" id="suggestions-list"></div>
          </div>
          <div class="settings-grid">
            <div class="setting">
              <label for="sprite-frame-width">프레임 너비 (px)</label>
              <input type="number" id="sprite-frame-width" value="64" min="1" />
            </div>
            <div class="setting">
              <label for="sprite-frame-height">프레임 높이 (px)</label>
              <input type="number" id="sprite-frame-height" value="64" min="1" />
            </div>
            <div class="setting">
              <label for="sprite-columns">열 수 (자동: 0)</label>
              <input type="number" id="sprite-columns" value="0" min="0" />
            </div>
            <div class="setting">
              <label for="sprite-rows">행 수 (자동: 0)</label>
              <input type="number" id="sprite-rows" value="0" min="0" />
            </div>
            <div class="setting">
              <label for="sprite-total-frames">총 프레임 수 (자동: 0)</label>
              <input type="number" id="sprite-total-frames" value="0" min="0" />
            </div>
            <div class="setting">
              <label for="sprite-start-index">시작 인덱스</label>
              <input type="number" id="sprite-start-index" value="0" min="0" />
            </div>
          </div>
          <div class="action-buttons">
            <button id="split-sprite-btn" class="primary-btn">프레임 분할</button>
          </div>
        </section>

        <!-- Step 2: 프레임 추출 설정 -->
        <section class="step" id="step-extract" hidden>
          <h2>2. 프레임 추출 설정</h2>
          <div class="settings-grid">
            <div class="setting">
              <label for="fps">FPS (초당 프레임 수)</label>
              <input type="number" id="fps" value="12" min="1" max="60" />
            </div>
            <div class="setting">
              <label for="start-time">시작 시간 (초)</label>
              <input type="number" id="start-time" value="0" min="0" step="0.1" />
            </div>
            <div class="setting">
              <label for="end-time">종료 시간 (초)</label>
              <input type="number" id="end-time" value="0" min="0" step="0.1" />
            </div>
            <div class="setting">
              <label for="scale">스케일 (%)</label>
              <input type="number" id="scale" value="100" min="10" max="200" />
            </div>
          </div>
          <button id="extract-btn" class="primary-btn">프레임 추출</button>
        </section>

        <!-- Step 3: 프레임 미리보기 -->
        <section class="step" id="step-preview" hidden>
          <h2>3. 추출된 프레임 <span id="frame-count">(0개)</span></h2>
          <p class="hint">💡 프레임을 클릭하면 비활성화됩니다. 비활성화된 프레임은 최종 스프라이트에서 제외됩니다.</p>
          
          <!-- 애니메이션 미리보기 -->
          <div class="animation-preview">
            <div class="preview-canvas-container">
              <canvas id="preview-canvas"></canvas>
            </div>
            <div class="preview-controls">
              <button id="play-btn" class="control-btn">▶ 재생</button>
              <button id="stop-btn" class="control-btn">⏹ 정지</button>
              <div class="fps-control">
                <label for="preview-fps">FPS:</label>
                <input type="number" id="preview-fps" value="12" min="1" max="60" />
              </div>
              <span id="preview-info">프레임: 0/0</span>
            </div>
            <div class="preview-options">
              <label class="checkbox-label">
                <input type="checkbox" id="pingpong-checkbox" />
                <span>🔄 역방향 재생 붙이기 (핑퐁)</span>
              </label>
            </div>
          </div>
          
          <div class="frames-container" id="frames-container"></div>
          <div class="action-buttons">
            <button id="select-all-btn" class="control-btn">전체 선택</button>
            <button id="deselect-all-btn" class="control-btn">전체 해제</button>
            <button id="remove-bg-btn" class="secondary-btn">배경 제거 (AI)</button>
            <button id="generate-sprite-btn" class="primary-btn">스프라이트 시트 생성</button>
          </div>
        </section>

        <!-- Step 4: 결과 -->
        <section class="step" id="step-result" hidden>
          <h2>4. 결과</h2>
          <div class="result-container">
            <canvas id="sprite-canvas"></canvas>
          </div>
          <div class="sprite-info" id="sprite-info"></div>
          <div class="action-buttons">
            <button id="download-png-btn" class="primary-btn">PNG 다운로드</button>
            <button id="download-json-btn" class="secondary-btn">JSON 메타데이터 다운로드</button>
          </div>
        </section>

        <!-- Progress -->
        <div class="progress-overlay" id="progress-overlay" hidden>
          <div class="progress-content">
            <div class="spinner"></div>
            <p id="progress-text">처리 중...</p>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
